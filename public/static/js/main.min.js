const api=axios.create({baseURL:"https://api.themoviedb.org/3/",headers:{"Content-Type":"application/json;charset=utf-8"},params:{api_key:API_KEY,language:navigator.language||"es-ES"}});function likedMoviesList(){const e=JSON.parse(localStorage.getItem("liked_movies"));let t;return t=e||{}}function likeMovie(e){const t=likedMoviesList();t[e.id]?t[e.id]=void 0:t[e.id]=e,localStorage.setItem("liked_movies",JSON.stringify(t))}const lazyLoader=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.getAttribute("data-img");e.target.setAttribute("src",t),lazyLoader.unobserve(e.target)}})});function createMovies(e,t,{lazyLoad:a=!1,clean:i=!0}={}){i&&(t.innerHTML=""),e.forEach(e=>{const i=document.createElement("div");i.classList.add("movie-container");const n=document.createElement("img");n.classList.add("movie-img"),n.setAttribute("alt",e.title),n.addEventListener("click",()=>{location.hash="#movie="+e.id}),n.addEventListener("error",()=>{n.setAttribute("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOMUez6DwAD8AIIOhah/wAAAABJRU5ErkJggg==");const t=document.createElement("span"),a=document.createTextNode(e.title);i.appendChild(t),t.appendChild(a)}),n.setAttribute(a?"data-img":"src","https://image.tmdb.org/t/p/w300"+e.poster_path);const o=document.createElement("button");o.classList.add("movie-btn"),likedMoviesList()[e.id]&&o.classList.toggle("movie-btn--liked"),o.addEventListener("click",()=>{o.classList.toggle("movie-btn--liked"),likeMovie(e),window.location.reload()}),a&&lazyLoader.observe(n),i.appendChild(n),i.appendChild(o),t.appendChild(i)})}function createCategories(e,t){t.innerHTML="",e.forEach(e=>{const a=document.createElement("div");a.classList.add("category-container");const i=document.createElement("h3");i.classList.add("category-title"),i.setAttribute("id","id"+e.id),i.addEventListener("click",()=>{location.hash=`#category=${e.id}-${e.name}`.toLowerCase().replace(/ /g,"-")});const n=document.createTextNode(e.name);i.appendChild(n),a.appendChild(i),t.appendChild(a)})}async function getTrendingMoviesPreview(){const{data:e}=await api("trending/movie/day");createMovies(e.results,trendingMoviesPreviewList,{lazyLoad:!0,clean:!0})}async function getCategegoriesPreview(){const{data:e}=await api("genre/movie/list");createCategories(e.genres,categoriesPreviewList)}async function getMoviesByCategory(e){const{data:t}=await api("discover/movie",{params:{with_genres:e}}),a=t.results;maxPage=t.total_pages,console.log(maxPage),createMovies(a,genericSection,{lazyLoad:!0,clean:!0})}function getPaginatedMoviesByCategory(e){return async function(){const{scrollTop:t,scrollHeight:a,clientHeight:i}=document.documentElement,n=page<maxPage;if(t+i>=a-15&&n){page++;const{data:t}=await api("discover/movie",{params:{with_genres:e,page:page}});createMovies(t.results,genericSection,{lazyLoad:!0,clean:!1})}}}async function getMoviesBySearch(e){const{data:t}=await api("search/movie",{params:{query:e}}),a=t.results;maxPage=t.total_pages,console.log(maxPage),createMovies(a,genericSection,{lazyLoad:!0,clean:!0})}function getPaginatedMoviesBySearch(e){return async function(){const{scrollTop:t,scrollHeight:a,clientHeight:i}=document.documentElement,n=page<maxPage;if(t+i>=a-15&&n){page++;const{data:t}=await api("search/movie",{params:{query:e,page:page}});createMovies(t.results,genericSection,{lazyLoad:!0,clean:!1})}}}async function getTrendingMovies(){const{data:e}=await api("trending/movie/day"),t=e.results;maxPage=e.total_pages,createMovies(t,genericSection,{lazyLoad:!0,clean:!0})}async function getPaginatedTrendingMovies(){const{scrollTop:e,scrollHeight:t,clientHeight:a}=document.documentElement,i=page<maxPage;if(e+a>=t-15&&i){page++;const{data:e}=await api("trending/movie/day",{params:{page:page}});createMovies(e.results,genericSection,{lazyLoad:!0,clean:!1})}}async function getMovieById(e){const{data:t}=await api("movie/"+e),a="https://image.tmdb.org/t/p/w500"+t.poster_path;headerSection.style.background=`\n    linear-gradient(\n      180deg,\n      rgba(0, 0, 0, 0.35) 19.27%,\n      rgba(0, 0, 0, 0) 29.17%\n    ),\n    url(${a})\n  `,movieDetailTitle.textContent=t.title,movieDetailDescription.textContent=t.overview,movieDetailScore.textContent=t.vote_average,createCategories(t.genres,movieDetailCategoriesList),getRelatedMoviesId(e)}async function getRelatedMoviesId(e){const{data:t}=await api(`movie/${e}/recommendations`);createMovies(t.results,relatedMoviesContainer,{lazyLoad:!0,clean:!0})}function getLikedMovies(e){const t=likedMoviesList(),a=Object.values(t);console.log(t),createMovies(a,likedMoviesListArticle,{lazyLoad:!0,clean:!0}),likedMoviesListArticle.innerHTML="",!a.length&&likedMoviesSection.classList.add("inactive"),createMovies(a,likedMoviesListArticle),window.addEventListener("storage",()=>{console.log(JSON.parse(window.localStorage.getItem("sampleList")))})}